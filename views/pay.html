<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>

    <link rel="stylesheet" href="/public/css/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css" />
    <link rel="stylesheet" href="/public/css/common.css">
    <link rel="stylesheet" href="/public/css/pay.css">

    <script src="/public/jquery/jquery-3.6.1.min.js"></script>
    <script src="/public/jquery/jquery-ui-1.13.2/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
    <script src="/common.js"></script>
    <script src="/public/js/pay.js"></script>
    <script>

    </script>

</head>

<body class="pg_pay">

    <header>
        <a href="javascript:window.history.back();"><img src="/public/img/common/back.svg" alt="back"></a>
        <h1>결제</h1>
        <span></span>
    </header>
    <main>
        <div class="top">
            <p>상담 유형을 선택해주세요!</p>
            <span>블라블라 워딩필요</span>

            <div class="wrap_type">
                <div>
                    <input type="radio" id="option1" name="type">
                    <label for="option1">문자 상담권<span>(2회 당 4,000원/회)</span></label>

                    <div class="quantity-controls">
                        <button type="button" id="minus-btn" class="btn_minus"></button>
                        <input type="number" id="quantity" name="quantity" value="0" min="0">
                        <button type="button" id="plus-btn" class="btn_plus"></button>
                    </div>
                </div>
                <div>
                    <input type="radio" id="option2" name="type">
                    <label for="option2">화상 20분 상담권</label>
                </div>
            </div>

            <div class="wrap_coupon">
                <label>
                    <input type="checkbox" id="couponUse">
                    쿠폰 사용하기
                </label>
                <div class="coupon">
                    <img src="/public/img/common/coupon_free.svg" alt="coupon_free">
                    <div>
                        <p>화상상담 1회 무료 이용권</p>
                        <p>D - 10</p>
                        <p><span>32일남음</span> 2023.10.23~2023.1222</p>
                    </div>
                </div>

                <p>무료쿠폰을 신청하고 싶으시다면? <a>쿠폰신청하기</a></p>
            </div>

            <div class="wrap_amount">
                <span>결제 예정 금액</span>
                <span>14,900원</span>
            </div>

        </div>

        <div class="middle">

            <p>상담은 언제가 좋으세요?</p>
            <span>담당 전문가의 확인 후 일정이 결정되요!</span>

            <div class="wrap_time">
                <div class="time_selected">첫 번째 시간 제안하기</div>
            </div>

            <div id="myModal" class="modal">
                <div class="modal-content">
                    <p>첫 번째 상담일정을 선택해주세요!</p>
                    <div id="datepicker"></div>
                    <div class="wrap_time_select">
                        <div class="time_select">오후 7:00 ~ 오후 8:00</div>
                    </div>
                </div>
            </div>

            <!-- <script>
                $(function () {

                    $('#datepicker').datepicker({

                        dateFormat: 'yy-mm-dd'
                        , showOtherMonths: true
                        , showMonthAfterYear: true
                        , changeYear: true
                        , changeMonth: true
                        , showOn: "both"
                        , buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"
                        , buttonImageOnly: true
                        , buttonText: "선택"
                        , yearSuffix: "년"
                        , monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12']
                        , monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월']
                        , dayNamesMin: ['일', '월', '화', '수', '목', '금', '토']
                        , dayNames: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일']
                        , minDate: "-5Y"
                        , maxDate: "+5y",
                        onSelect: function (dateText, inst) {
                        fetchExpertsTimes(dateText);
                        },
                        prevText: "이전",
                        nextText: "다음",
                    });




                    var activeTimeSelected;

                    $(".time_selected").click(function() {
                        $(".time_selected").removeClass("active");
                        $(this).addClass("active");
                        activeTimeSelected = $(this);
                        $("#myModal").show();
                    });


                        async function fetchExpertsTimes(selectedDate) {
                            try {
                                const url = `http://43.201.79.49/mds/635a359d731b7f22f9c438fe/date/${selectedDate}`;
                                console.log(url);
                                const response = await fetch(url, { method: "GET" });

                                if (!response.ok) {
                                    throw new Error(`Network response was not ok (${response.status})`);
                                }

                                const result = await response.json();
                                displayTimeSlots(result.data); 
                                console.log(result.data);
                            } catch (error) {
                                console.error("데이터 가져오기 오류:", error);
                            }
                        }

                        function displayTimeSlots(data) {
                            $('.wrap_time_select').empty();
                            data.forEach(item => {
                                console.log("원본 UTC 시간 (서버에서 받음):", item.date_time);

                                let utcDate = new Date(item.date_time);
                                console.log("Date 객체로 변환된 UTC 시간:", utcDate);

                                let kstDate = new Date(utcDate.getTime() - (9 * 60 * 60000)); // UTC에서 9시간 빼기
                                console.log("한국 시간으로 변환된 시간:", kstDate);

                                let hours = kstDate.getHours();
                                let ampm = hours >= 12 ? '오후' : '오전';
                                hours = hours % 12;
                                hours = hours || 12; // 0시는 12시로 표시
                                let minutes = kstDate.getMinutes().toString().padStart(2, '0');

                                let koreaTimeStr = `${ampm} ${hours}:${minutes}`;
                                console.log("최종적으로 표시될 문자열:", koreaTimeStr);

                                $('.wrap_time_select').append(`<div class="time_select">${koreaTimeStr}</div>`);
                            });
                        }


                    $(document).on("click", ".time_select", function() {
                        var selectedTime = $(this).text().split('~')[0].trim();
                        var time24 = convertTo24Hour(selectedTime);

                        var selectedDate = $("#datepicker").datepicker('getDate');
                        var formattedDateTime = $.datepicker.formatDate('yy-mm-dd', selectedDate) + ' ' + time24;

                        if (activeTimeSelected) {
                            activeTimeSelected.text(formattedDateTime);
                        }

                        $("#myModal").hide();

                    });

                    function convertTo24Hour(time) {
                    
                        time = time.trim();

                        console.log("Received time string:", time);

                        var matches = time.match(/(\d+):(\d+)\s*(오전|오후)/);
                        if (matches) {
                            var hours = Number(matches[1]);
                            var AMPM = matches[3];
                            if (AMPM === "오후" && hours < 12) hours += 12;
                            if (AMPM === "오전" && hours === 12) hours = 0;

                            return hours.toString().padStart(2, '0') + ":" + matches[2] + ":00";
                        } else {
                            console.error("Invalid time format:", time); 
                            return "00:00:00";
                        }
                    }


                    $(document).on("click", ".time_select", function () {
                        $('.time_select').removeClass('active');
                        $(this).addClass('active');
                    });

                    $(document).on("click", ".time_selected", function () {
                        $("#myModal").show();
                    });

                    $(window).on("click", function (event) {
                        if ($(event.target).is("#myModal")) {
                            $("#myModal").hide();
                        }
                    });
                });

            </script> -->

        </div>

        <div class="bottom">

            <p>어떤 내용을 상담하고 싶으신가요? </p>
            <span>상담 내용을 자세히 기재해주시면 보다 정확한 상담이 가능해요!</span>

            <input type="text" placeholder="제목">
            <textarea placeholder="내용을 입력해 주세요"></textarea>

        </div>


        <div class="wrap_bottom">
            <button type="button">예약하기</button>
            <div class="wrap_like">
                <img src="/public/img/common/like_gray_fill.svg" alt="like_gray_fill">
                <span>찜하기</span>
            </div>
        </div>

    </main>

</body>

</html>