<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>

    <!-- css -->
    <link rel="stylesheet" href="/public/css/reset.css">
    <link rel="stylesheet" href="/public/css/common.css">
    <link rel="stylesheet" href="/public/css/mypage.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css" />

    <!-- js -->
    <script src="/public/jquery/jquery-3.6.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
    <script src="/public/js/common.js"></script>
    <script>

document.addEventListener('DOMContentLoaded', function () {
    const logoutItem = Array.from(document.querySelectorAll('.item')).find(el => el.textContent.includes('로그아웃'));

    if (logoutItem) {
        logoutItem.addEventListener('click', async function() {
            try {
                const response = await fetch("http://43.201.79.49/users/logout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + sessionStorage.getItem('access_token')
                    },
                    body: JSON.stringify({
                        user_id: sessionStorage.getItem('user_id')
                    })
                });

                const data = await response.json();

                if (data.code === 200) {
                    Swal.fire({
                        text: '로그아웃되었습니다.',
                        toast: true,
                        position: 'bottom',
                        showConfirmButton: false,
                        timer: 2000,
                    });

                    const userText = document.querySelector('.user span');
                    if (userText) {
                        userText.textContent = '로그인/회원가입';
                    }

                    logoutItem.remove();

                    sessionStorage.removeItem('access_token');
                    sessionStorage.removeItem('social_token');
                    sessionStorage.removeItem('refresh_token');
                    sessionStorage.removeItem('user_id');
                    sessionStorage.removeItem('login_platform');
                } else {
                    console.error("로그아웃 실패: ", data.message);
                }
            } catch (error) {
                console.error("로그아웃 중 오류 발생: ", error);
            }
        });
    }
});


    </script>

</head>

<body class="pg_mypage verify_mobile">

    <header>
        <a href="javascript:window.history.back();"><img src="/public/img/common/back.svg" alt="back"></a>
        <h1>마이페이지</h1>
        <span></span>
    </header>
    <main>

        <div class="middle">
            <p>오늘도 커넥터즈하세요!</p>

            <div class="user" onclick="location.href='/views/myinfo.html'">
                <img src="/public/img/common/user.svg" alt="user">
                <span>귀요미</span>
                <img src="/public/img/common/arrow_right.svg" alt="arrow_right">
            </div>

            <div class="wrap_item">
                <div class="item" onclick="location.href='/views/mypage_pay.html'">
                    <img src="/public/img/common/purchase.svg" alt="purchase">
                    <span>구매관리</span>
                </div>
                |
                <div class="item" onclick="location.href='/views/mypage_review.html'">
                    <img src="/public/img/common/review.svg" alt="review">
                    <span>리뷰</span>
                </div>
                |
                <div class="item">
                    <img src="/public/img/common/coupon.svg" alt="coupon" onclick="location.href='/views/mypage_coupon.html'">
                    <span>쿠폰</span>
                </div>
            </div>


        </div>

        <div class="bottom">

            <div class="wrap_item">
                <div class="item">
                    <span>고객센터</span>
                    <img src="/public/img/common/arrow_right.gray.svg" alt="arrow_right">
                </div>
                <div class="item">
                    <span>약관</span>
                    <img src="/public/img/common/arrow_right.gray.svg" alt="arrow_right">
                </div>
                <div class="item">
                    <span>로그아웃</span>
                    <img src="/public/img/common/arrow_right.gray.svg" alt="arrow_right">
                </div>
            </div>
            
        </div>
        
    </main>
    
</body>

</html>