<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>

    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css" />
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/pay.css">

    <script src="./js/jquery-3.6.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"
        integrity="sha256-6XMVI0zB8cRzfZjqKcD01PBsAy3FlDASrlC8SxCpInY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
    <script src="./js/common.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {

            // type
            document.getElementById('plus-btn').addEventListener('click', function () {
                document.getElementById('quantity').stepUp();
            });

            document.getElementById('minus-btn').addEventListener('click', function () {
                document.getElementById('quantity').stepDown();
            });

            // coupon
            document.querySelector('#couponUse').addEventListener('change', function() {

                var coupon = document.querySelector('.coupon');

                if (coupon.style.borderColor === 'rgb(197, 184, 241)') {
                    coupon.style.borderColor = '';
                } else {
                    coupon.style.borderColor = '#C5B8F1';
                }

                // Toggle image source
                var img = coupon.querySelector('img');
                if (img) {
                    if (img.src.includes('coupon_active.svg')) {
                        img.src = './img/common/coupon_free.svg'; 
                    } else {
                        img.src = './img/common/coupon_active.svg';
                    }
                }

                var span = coupon.querySelector('p:nth-of-type(3) span');
                if (span) {
                    if (span.style.color === 'rgb(139, 113, 227)') {
                        span.style.color = ''; 
                    } else {
                        span.style.color = '#8B71E3';
                    }
                }
                });

            });

    </script>

</head>

<body class="pg_pay">

    <header>
        <a href="javascript:window.history.back();"><img src="./img/common/back.svg" alt="back"></a>
        <h1>결제</h1>
        <span></span>
    </header>
    <main>
        <div class="top">
            <p>상담 유형을 선택해주세요!</p>
            <span>블라블라 워딩필요</span>

            <div class="wrap_type">
                <div>
                    <input type="radio" id="option1" name="type">
                    <label for="option1">문자 상담권<span>(2회 당 4,000원/회)</span></label>

                    <div class="quantity-controls">
                        <button type="button" id="minus-btn" class="btn_minus"></button>
                        <input type="number" id="quantity" name="quantity" value="0" min="0">
                        <button type="button" id="plus-btn" class="btn_plus"></button>
                    </div>
                </div>
                <div>
                    <input type="radio" id="option2" name="type">
                    <label for="option2">화상 20분 상담권</label>
                </div>
            </div>

            <div class="wrap_coupon">
                <label>
                    <input type="checkbox" id="couponUse">
                    쿠폰 사용하기
                </label>
                <div class="coupon">
                    <img src="./img/common/coupon_free.svg" alt="coupon_free">
                    <div>
                        <p>화상상담 1회 무료 이용권</p>
                        <p>D - 10</p>
                        <p><span>32일남음</span> 2023.10.23~2023.1222</p>
                    </div>
                </div>

                <p>무료쿠폰을 신청하고 싶으시다면? <a>쿠폰신청하기</a></p>
            </div>

            <div class="wrap_amount">
                <span>결제 예정 금액</span>
                <span>14,900원</span>
            </div>

        </div>

        <div class="middle">

            <p>상담은 언제가 좋으세요?</p>
            <span>담당 전문가의 확인 후 일정이 결정되요!</span>

            <div class="wrap_time">
                <div class="time_selected">첫 번째 시간 제안하기</div>
                <div class="time_selected">두 번째 시간 제안하기</div>
                <div class="time_selected">세 번째 시간 제안하기</div>
            </div>

            <div id="myModal" class="modal">
                <div class="modal-content">
                    <p>첫 번째 상담일정을 선택해주세요!</p>
                    <div id="datepicker"></div>
                    <div class="wrap_time_select">
                        <div class="time_select">오후 7:00 ~ 오후 8:00</div>
                        <div class="time_select">오후 9:00 ~ 오후 10:00</div>
                        <div class="time_select">오후 10:00 ~ 오후 11:00</div>
                    </div>
                </div>
            </div>

            <script>
                $(function () {

                    $('#datepicker').datepicker({

                        dateFormat: 'yy-mm-dd'
                        , showOtherMonths: true
                        , showMonthAfterYear: true
                        , changeYear: true
                        , changeMonth: true
                        , showOn: "both"
                        , buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif"
                        , buttonImageOnly: true
                        , buttonText: "선택"
                        , yearSuffix: "년"
                        , monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12']
                        , monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월']
                        , dayNamesMin: ['일', '월', '화', '수', '목', '금', '토']
                        , dayNames: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일']
                        , minDate: "-5Y"
                        , maxDate: "+5y",
                        onSelect: function (dateText, inst) {
                            $("#date").val(dateText);
                            $("#date-top-right").text(dateText);
                        },
                        prevText: "이전",
                        nextText: "다음",
                    });


                    var activeTimeSelected;

                    $(".time_selected").click(function() {
                        $(".time_selected").removeClass("active");
                        $(this).addClass("active");
                        activeTimeSelected = $(this);
                        $("#myModal").show();
                    });

                    $(document).on("click", ".time_select", function() {
                        var selectedTime = $(this).text().split('~')[0].trim();
                        var time24 = convertTo24Hour(selectedTime);

                        var selectedDate = $("#datepicker").datepicker('getDate');
                        var formattedDateTime = $.datepicker.formatDate('yy-mm-dd', selectedDate) + ' ' + time24;

                        if (activeTimeSelected) {
                            activeTimeSelected.text(formattedDateTime);
                        }

                        $("#myModal").hide();
                    });

                    function convertTo24Hour(time) {
                        // 시작과 끝의 공백을 제거
                        time = time.trim();

                        console.log("Received time string:", time); // 전달받은 문자열 로그 출력

                        // 정규 표현식 수정: 0개 이상의 공백을 허용
                        var matches = time.match(/(\d+):(\d+)\s*(오전|오후)/);
                        if (matches) {
                            var hours = Number(matches[1]);
                            var AMPM = matches[3];
                            if (AMPM === "오후" && hours < 12) hours += 12;
                            if (AMPM === "오전" && hours === 12) hours = 0;

                            return hours.toString().padStart(2, '0') + ":" + matches[2] + ":00";
                        } else {
                            console.error("Invalid time format:", time); // 정규 표현식 매칭 실패시 로그 출력
                            return "00:00:00";
                        }
                    }


                    $(document).on("click", ".time_select", function () {
                        $('.time_select').removeClass('active');
                        $(this).addClass('active');
                    });

                    $(document).on("click", ".time_selected", function () {
                        $("#myModal").show();
                    });

                    $(window).on("click", function (event) {
                        if ($(event.target).is("#myModal")) {
                            $("#myModal").hide();
                        }
                    });
                });

            </script>

        </div>

        <div class="bottom">

            <p>어떤 내용을 상담하고 싶으신가요? </p>
            <span>상담 내용을 자세히 기재해주시면 보다 정확한 상담이 가능해요!</span>

            <input type="text" placeholder="제목">
            <textarea placeholder="내용을 입력해 주세요"></textarea>

        </div>


        <div class="wrap_bottom">
            <button type="button">예약하기</button>
            <div class="wrap_like">
                <img src="./img/common/like_gray_fill.svg" alt="like_gray_fill">
                <span>찜하기</span>
            </div>
        </div>

    </main>

</body>

</html>